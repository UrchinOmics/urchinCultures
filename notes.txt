#cjm 5/27/2025

I have expanded this analysis significantly in response to reviewer comments. The beginning of the analysis is unchanged - the same three shell scripts were used to launch the jobs to analyze raw reads. 
I now provide a .Rmd document - x_0092-analysis-paper-figs_2025-05-27.Rmd - that contains code which:

  1. performs QC steps including rRNA filtering, mtRNA filtering, and doublet filtering.
  2. plots data from QC steps.
  3. performs a very basic unintegrated analysis.
  4. performs the integrated analysis.
  5. projects cultured cells onto atlas umap space using an unintegrated analysis of the developmental atlas using seurat's MapQuery function.
  6. calculates a distance-weighted pseudotime from k=20 nearest neighbors for cultured cells plotted in atlas umap space. 
  7. generates the following plots:
    a. Figure 4A
      i. cells in integrated umap space, colored by hours post fertilization or percent FBS in culture media, with highlighting for specific subsets of cells:
        1. skeletogenic and pigment cells from cultures - highlighted with larger point size, greater opacity, and a black border
        2. Atlas cells which are within a distance of 0.1 from a cultured cell and whose 200 nearest neighbors consist of > 75% cultured cells - highlighted by larger, more opaque points. 
        3. Cultured cells which are within a distance of 0.1 from an atlas cell and whose 200 nearest neighbors consist of > 75% atlas cells - highlighted by larger, more opaque points. 
      ii. labeling for select cluster centroids
    b. Figure 4B: Cells in integrated umap space colored and labeled by cluster number with highlighting as in 7.a.i.2-3 above. 
    c. Figure 4C: A cladogram of inter-cluster relatedness rooted in cluster 3 (which corresponds to totipotent 2hpf blastomeres), and stacked bars representing the composition by source (atlas vs cultured cells) of each cluster. 
    d. Figure 4D: Cells plotted in atlas umap space with atlas cells colored (in greyscale) by developmental time, and cultured cells (viridis palette) colored by a pseudotime derived from #6 above. 
    e. Figure S7: a dotplot showing expression of select genes from the developmental GRN (and select other marker, proliferative, and stemness genes) by cluster
    f. Figure S8: Expression density of key marker and stemness genes plotted using plot_density() from the nebulosa package. 
      i. In short, this is passing a 2d kernel density estimator over a featureplot/geom_point. The effect is a smoothing that helps to make better visualizations in sparse data like that generated by scRNAseq.
    g. Figure S9: pseudotime and developmental time plotted in integrated UMAP space. This is a companion figure to figure 4D. 
  8. Session info from the analysis in R. 

I additionally provide the following files:
1. functions.R - Code sourced in the main .Rmd document containing all custom functions used in our analysis. Many of these were used in exploratory analysis and are not called in the x_0092-analysis-paper-figs_2025-05-27.Rmd script. Most are convenience and plotting functions. 
2. read_raw_seurat_objects.R - Code sourced in the main .Rmd document to read in data processed by cellranger
3. pull_massri_2021_data.R - Code sourced in the main .Rmd document pull the seurat object for the original atlas analysis from SRA to use for comparison. 
  a. note, I processed all data from raw reads obtained from SRA. The analysis in the Massri 2021 paper uses an older version of the Lvar_3.0 genome annotations, and is not directly comparable to the version of the atlas processed with the newer annotations, though it is still useful for certain "sanity checks".
4. ribosomal_LOCs.txt - a list of ribosomal gene names used in this analysis during QC steps. 

Some big changes from the last analysis: 
1. I now provide an estimate of developmental age for cultured cells which strongly points towards a naive or stem-like state. Ultimately, I want to run the cytoTRACE algorithm on these data, but I need to refactor that code in order to more efficently use memory for a data set of this size, which is no easy task and is squarely in the domain of a second paper. 
2. I now show that that cultured cells are mostly distinct from atlas cells, but do converge on several terminal fates, likely via a blastocoelear-like intermediary state, reminescent of the transfating events observed by the McClay and Wray labs in lytechinus variegatus embryos where the micromeres have been surgically removed. 
3. Additional evidence of cultured cell stem-like states is provided in the form of marker gene density/expression (supplemental figures S7 and S8) for the stem- and PGC- related markers Nanos, Seawi, Pumilio, Vasa, Klf7, SoxB1, Chd1, Vparpf (Parp1), and Dmrt, alongside proliferative markers including Cyclins A and B1, Ki67, Pcna, and Histone H1. 



If you have questions about this portion of our analysis, you can reach out to me via Github or reach out to the corresponding author for the manuscript. 


#cjm 12/2/2024
the goal of this work is to integrate the scRNAseq from the cell cultures with the scRNAseq developmental atlas. 
we intend to show that cells in culture co-cluster with developmental cell types. 
however, it is quite possible that the cultured cells will be rather distinct. 

either way, the goal is the same. integrate the data and put them onto the same umap space. 
then I do clustering and ask if clusters are composed of cells both from cultures and the atlas, or whether they're separate. 

Bash scripts are numbered in the order they were run. 
first up, I made a reference transcriptome with cellranger using annotations that I pulled from NCBI. (1_mkrefgenome.sh)
I put all the reads into the same folder and generated a sample list. these are just base sample names. (2_mvreads.sh)
Submitted cellranger count jobs for each sample via sbatch wrap. see scripts/3_count.sh for specific count parameters. (3_count.sh)
Clean things up a little. Making an output directory for cellranger and copy the output over there.  

at this point, I move into R. See scRNA_seq_integration_analysis.R
